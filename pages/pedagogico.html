<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="UTF-8">
    <title>Pedag√≥gico | ODIN OS</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>

    <script>
        tailwind.config = { darkMode: 'class', theme: { extend: { fontFamily: { sans: ['Inter', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'], }, colors: { dark: { 900: '#050507', 800: '#0E0E12', 700: '#1A1A23', 600: '#2A2A35' }, neon: { cyan: '#00F0FF', violet: '#7000FF', green: '#00FF94', red: '#FF003C', orange: '#F59E0B', pink: '#FF0080' } }, animation: { 'marquee': 'marquee 25s linear infinite', }, keyframes: { marquee: { '0%': { transform: 'translateX(100%)' }, '100%': { transform: 'translateX(-100%)' } } } } } }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .glass-panel { @apply bg-dark-800/60 backdrop-blur-xl border border-dark-700 shadow-lg; }
            .input-tech { @apply w-full bg-dark-900 border border-dark-600 rounded p-3 text-white font-mono focus:border-neon-pink focus:shadow-[0_0_10px_rgba(255,0,128,0.2)] outline-none transition-all placeholder-gray-600 text-sm; }
            .fc { @apply font-sans text-gray-300; --fc-border-color: #1A1A23; --fc-today-bg-color: rgba(255, 158, 11, 0.1); }
            .fc-toolbar-title { @apply text-white uppercase tracking-widest text-sm font-bold !important; }
            .fc-button { @apply bg-dark-700 border-dark-600 text-xs uppercase font-bold hover:bg-neon-pink hover:text-white transition !important; }
            .fc-button-active { @apply bg-neon-pink border-neon-pink text-white !important; }
            .table-builder th { @apply text-[10px] uppercase text-gray-500 font-bold pb-2 border-b border-dark-700; }
            .table-builder td { @apply py-2 border-b border-dark-800; }
            .lifecycle-bar { @apply h-2 bg-dark-900 rounded-full overflow-hidden; }
            .lifecycle-fill { @apply h-full bg-neon-cyan transition-all duration-1000; }
        }
        body { @apply bg-dark-900 text-gray-300; }
    </style>
</head>
<body class="flex flex-col min-h-screen">
    
    <div id="header-placeholder"></div>

    <div class="fixed top-20 md:top-24 left-0 w-full h-8 bg-dark-800 border-b border-dark-700 flex items-center overflow-hidden z-40 pointer-events-none">
        <div class="whitespace-nowrap animate-marquee text-xs font-mono flex gap-12" id="dynamic-ticker">
            <span class="text-gray-400">SENTINELA: <span class="text-neon-green">ATIVO</span></span>
            <span class="text-gray-400">BASE DE DADOS: <span class="text-neon-cyan">ATUALIZADA 2025</span></span>
            <span class="text-gray-400">FERIADOS: <span class="text-neon-pink">MAPEADOS</span></span>
        </div>
    </div>

    <main class="flex-grow pt-32 md:pt-40 px-4 md:px-6 container mx-auto pb-20">
        <div class="flex flex-col md:flex-row justify-between items-end mb-6 gap-4 border-b border-dark-700 pb-6">
            <div>
                <div class="flex items-center gap-2 text-neon-pink mb-2 font-mono text-xs tracking-widest uppercase">
                    <div class="w-2 h-2 bg-neon-pink rounded-full animate-pulse"></div> Gest√£o Inteligente
                </div>
                <h1 class="text-3xl md:text-5xl font-black text-white tracking-tight">
                    Pedag√≥gico <span class="text-dark-700">/</span> Odin
                </h1>
            </div>
            
            <div class="flex gap-3">
                <button onclick="openReportModal()" class="bg-dark-800 border border-neon-cyan text-neon-cyan font-bold py-2 px-4 rounded hover:bg-neon-cyan hover:text-dark-900 transition text-xs uppercase tracking-widest flex items-center gap-2">
                    <i class="fas fa-chart-bar"></i> Nexus Docente
                </button>
                <button onclick="openClassBuilder()" class="bg-neon-pink text-white font-bold py-2 px-4 rounded hover:bg-pink-600 transition shadow-lg shadow-neon-pink/20 text-xs uppercase tracking-widest flex items-center gap-2">
                    <i class="fas fa-layer-group"></i> Nova Turma
                </button>
                <button onclick="openEventModal()" class="bg-dark-800 border border-neon-pink text-neon-pink font-bold py-2 px-4 rounded hover:bg-neon-pink hover:text-white transition text-xs uppercase tracking-widest">
                    <i class="fas fa-calendar-plus"></i> Agenda
                </button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 h-full">
            
            <div class="lg:col-span-8">
                <div class="glass-panel p-4 rounded-xl h-[700px]">
                    <div id='calendar' class="h-full"></div>
                </div>
            </div>

            <div class="lg:col-span-4 space-y-6">
                
                <div class="glass-panel rounded-xl overflow-hidden flex flex-col h-[450px]">
                    <div class="p-4 border-b border-dark-700 bg-dark-800/80 flex justify-between items-center">
                        <h3 class="text-white font-bold text-sm flex items-center"><i class="fas fa-sync-alt mr-2 text-neon-green"></i> Ciclo de Turmas</h3>
                        <span class="text-[10px] text-gray-500 font-mono uppercase">Monitoramento</span>
                    </div>
                    <div class="overflow-y-auto custom-scroll p-4 space-y-4" id="lifecycle-list">
                        <p class="text-xs text-gray-500 text-center mt-4">Nenhuma turma ativa.</p>
                    </div>
                </div>

                <div class="glass-panel p-4 rounded-xl h-[225px] overflow-hidden flex flex-col">
                    <h4 class="text-[10px] text-gray-500 uppercase font-bold mb-3">Pr√≥ximos Eventos</h4>
                    <div id="upcoming-list" class="overflow-y-auto custom-scroll space-y-2 flex-grow"></div>
                </div>

            </div>
        </div>
    </main>

    <div id="class-builder-modal" class="fixed inset-0 bg-black/95 backdrop-blur-md z-50 hidden flex items-center justify-center p-4 animate-[fadeIn_0.3s]">
        <div class="glass-panel rounded-2xl w-full max-w-6xl border border-neon-pink/30 relative flex flex-col h-[90vh]">
            
            <div class="p-6 border-b border-dark-700 flex justify-between items-center bg-dark-800/50 rounded-t-2xl">
                <div>
                    <h2 class="text-2xl font-bold text-white flex items-center"><i class="fas fa-cubes text-neon-pink mr-3"></i> Construtor Inteligente</h2>
                    <p class="text-xs text-gray-400 mt-1">Dados baseados nos Cronogramas e Escala 2025.</p>
                </div>
                <button onclick="closeClassBuilder()" class="text-gray-500 hover:text-white text-xl"><i class="fas fa-times"></i></button>
            </div>

            <div class="flex-grow overflow-hidden flex flex-col md:flex-row">
                <div class="w-full md:w-1/4 p-6 border-r border-dark-700 space-y-5 bg-dark-900/30 overflow-y-auto">
                    <div>
                        <label class="text-[10px] text-neon-pink uppercase font-bold block mb-1">1. Curso Base (Real)</label>
                        <select id="builder-template" class="input-tech cursor-pointer" onchange="loadTemplate()">
                            <option value="" disabled selected>Carregar Grade...</option>
                            <option value="pedagogia">Pedagogia (Licenciatura)</option>
                            <option value="neuro">P√≥s Neuropsicopedagogia</option>
                            <option value="gestao">P√≥s Gest√£o Escolar</option>
                            <option value="inclusiva">P√≥s Educa√ß√£o Inclusiva</option>
                            <option value="psicologia">P√≥s Psicologia da Educa√ß√£o</option>
                            <option value="alfabetizacao">P√≥s Alfabetiza√ß√£o e Letramento</option>
                            <option value="aee">P√≥s Atendimento Educ. Esp. (AEE)</option>
                            <option value="enem">Enem dos Professores</option>
                        </select>
                    </div>
                    <div><label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">2. Nome da Turma</label><input type="text" id="builder-name" class="input-tech border-l-4 border-l-neon-pink" placeholder="Ex: PEDAGOGIA TER√áA A25"></div>
                    <div><label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">3. Hor√°rio</label><input type="text" id="builder-time" class="input-tech text-neon-cyan font-bold" placeholder="Ex: 19h00 √†s 22h00"></div>

                    <div class="p-3 bg-dark-800 rounded border border-dark-600">
                        <h4 class="text-[10px] font-bold text-white uppercase mb-2 flex items-center justify-between"><span>Gerador</span> <i class="fas fa-robot text-neon-cyan"></i></h4>
                        <div class="space-y-2">
                            <div><label class="text-[10px] text-gray-500 block">In√≠cio</label><input type="date" id="builder-start" class="input-tech" onchange="filterTeachersByDay()"></div>
                            <div><label class="text-[10px] text-gray-500 block">Frequ√™ncia</label><select id="builder-freq" class="input-tech"><option value="monthly" selected>Mensal (1x M√™s)</option><option value="weekly">Semanal (7 Dias)</option></select></div>
                            <div class="flex items-center gap-2 mt-2"><input type="checkbox" id="skip-holidays" class="w-3 h-3 rounded bg-dark-900 border-dark-600 text-neon-pink focus:ring-0" checked><label for="skip-holidays" class="text-[10px] text-gray-400 cursor-pointer">Pular Feriados (Escala)</label></div>
                            <button onclick="generateDates()" class="w-full bg-neon-cyan text-dark-900 text-xs font-bold py-2 rounded hover:bg-white transition mt-2">Gerar & Validar</button>
                        </div>
                    </div>
                    <div id="conflict-alert" class="hidden p-3 bg-red-500/10 border border-red-500/50 rounded text-red-400 text-[10px] font-bold animate-pulse"><i class="fas fa-exclamation-triangle mr-1"></i> <span id="conflict-msg">Conflito!</span></div>
                </div>

                <div class="w-full md:w-3/4 p-6 bg-dark-800/20 flex flex-col h-full">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-sm font-bold text-white uppercase tracking-wider">Grade Curricular</h3>
                        <div class="flex gap-2">
                            <button onclick="addSubjectRow()" class="text-xs bg-dark-700 hover:bg-white hover:text-dark-900 text-white px-3 py-1 rounded border border-gray-600 transition"><i class="fas fa-plus mr-1"></i> Add</button>
                            <button onclick="exportTeacherPDF()" class="text-xs bg-dark-700 hover:bg-neon-cyan hover:text-dark-900 text-neon-cyan px-3 py-1 rounded border border-neon-cyan/30 transition"><i class="fas fa-chalkboard-teacher mr-1"></i> Di√°rio</button>
                            <button onclick="exportSchedulePDF()" class="text-xs bg-neon-green hover:bg-white text-dark-900 px-4 py-1 rounded font-bold transition shadow-lg shadow-neon-green/20"><i class="fas fa-file-pdf mr-1"></i> PDF Aluno</button>
                        </div>
                    </div>
                    <div class="overflow-y-auto custom-scroll flex-grow bg-dark-900/50 rounded-lg border border-dark-700"><table class="w-full text-left table-builder"><thead class="bg-dark-800 sticky top-0 z-10"><tr><th class="pl-4 w-10">#</th><th class="w-32">Data</th><th>Disciplina</th><th class="w-48 text-gray-600">Professor (Dispon√≠vel)</th><th class="w-10 text-center"></th></tr></thead><tbody id="builder-list"><tr><td colspan="5" class="text-center py-8 text-gray-600 italic">Selecione um curso...</td></tr></tbody></table></div>
                </div>
            </div>
            <div class="p-4 border-t border-dark-700 bg-dark-800/80 rounded-b-2xl flex justify-end gap-3"><button onclick="closeClassBuilder()" class="px-6 py-2 rounded text-sm font-bold text-gray-400 hover:text-white transition">Fechar</button><button onclick="saveClassToCalendar()" class="px-8 py-2 rounded bg-neon-pink text-white text-sm font-bold hover:bg-pink-600 transition shadow-lg shadow-neon-pink/20 flex items-center gap-2"><i class="fas fa-calendar-check"></i> Salvar Cronograma</button></div>
        </div>
    </div>

    <div id="report-modal" class="fixed inset-0 bg-black/90 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4 animate-[fadeIn_0.2s]">
        <div class="glass-panel p-6 rounded-xl w-full max-w-lg border border-neon-cyan relative">
            <button onclick="closeReportModal()" class="absolute top-4 right-4 text-gray-500 hover:text-white"><i class="fas fa-times"></i></button>
            <h3 class="text-xl font-black text-white mb-6 flex items-center gap-2"><i class="fas fa-chart-bar text-neon-cyan"></i> NEXUS DOCENTE</h3>
            <div class="flex gap-4 mb-4">
                <input type="month" id="report-month" class="input-tech" onchange="generateReport()">
                <div class="bg-dark-900 p-2 rounded border border-dark-600 flex-grow text-center"><span class="text-[10px] text-gray-500 block">Total Aulas</span><span class="text-xl font-bold text-white" id="report-total">0</span></div>
            </div>
            <div class="overflow-y-auto max-h-[300px] custom-scroll bg-dark-900/50 rounded border border-dark-700 p-2" id="report-list"></div>
            <div class="mt-4 pt-4 border-t border-dark-700 flex justify-end"><button onclick="copyReport()" class="bg-neon-cyan text-dark-900 font-bold py-2 px-6 rounded hover:bg-white transition text-xs uppercase tracking-widest"><i class="fas fa-copy mr-2"></i> Copiar Relat√≥rio</button></div>
        </div>
    </div>

    <div id="event-modal" class="fixed inset-0 bg-black/90 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4 animate-[fadeIn_0.2s]">
        <div class="glass-panel p-6 rounded-xl w-full max-w-md border border-dark-600 relative">
            <button onclick="closeEventModal()" class="absolute top-4 right-4 text-gray-500 hover:text-white"><i class="fas fa-times"></i></button>
            <h3 class="text-lg font-bold text-white mb-6 flex items-center gap-2"><i class="far fa-calendar-alt text-neon-pink"></i> <span id="modal-title">Detalhes</span></h3>
            <input type="hidden" id="evt-id"><input type="hidden" id="evt-class-id">
            <div class="space-y-4">
                <div id="class-controls" class="hidden bg-dark-800 border-l-4 border-neon-cyan p-4 rounded mb-4">
                    <h4 class="text-xs font-bold text-neon-cyan uppercase mb-2">Gest√£o da Turma</h4>
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="downloadClassPDF()" class="bg-dark-900 hover:bg-neon-green hover:text-dark-900 text-white py-2 rounded text-[9px] font-bold transition flex flex-col items-center justify-center gap-1"><i class="fas fa-file-pdf"></i> Aluno</button>
                        <button onclick="downloadTeacherPDF()" class="bg-dark-900 hover:bg-neon-cyan hover:text-dark-900 text-white py-2 rounded text-[9px] font-bold transition flex flex-col items-center justify-center gap-1"><i class="fas fa-chalkboard-teacher"></i> Di√°rio</button>
                        <button onclick="deleteEntireClass()" class="bg-dark-900 hover:bg-red-500 hover:text-white text-red-500 py-2 rounded text-[9px] font-bold transition flex flex-col items-center justify-center gap-1"><i class="fas fa-trash-alt"></i> Excluir</button>
                    </div>
                </div>
                <div><label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">T√≠tulo</label><input type="text" id="evt-title" class="input-tech font-bold"></div>
                <div class="grid grid-cols-2 gap-3">
                    <div><label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">Data</label><input type="date" id="evt-date" class="input-tech"></div>
                    <div><label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">Cor</label><select id="evt-color" class="input-tech"><option value="#FF0080">Suporte</option><option value="#00F0FF">Reuni√£o</option><option value="#00FF94">Aula</option></select></div>
                </div>
                <div class="p-3 bg-green-900/20 border border-green-500/30 rounded flex items-center justify-between">
                    <div><p class="text-[10px] text-green-400 font-bold uppercase">Notificar Turma</p><p class="text-[9px] text-gray-400">Copiar aviso de aula</p></div>
                    <button onclick="copyClassNotice()" class="bg-green-500 hover:bg-white text-dark-900 p-2 rounded-full transition"><i class="fab fa-whatsapp"></i></button>
                </div>
                <div class="flex justify-between mt-6 pt-4 border-t border-dark-700 items-center">
                    <button onclick="deleteEvent()" id="btn-delete" class="text-red-500 hover:text-white text-sm flex items-center gap-1 hidden"><i class="fas fa-trash"></i> Excluir</button>
                    <button onclick="saveEvent()" class="bg-neon-pink text-white font-bold py-2 px-6 rounded hover:bg-pink-600 text-xs uppercase tracking-widest ml-auto">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <datalist id="professores-list">
        <option value="Prof. Robson"><option value="Prof. Andreia"><option value="Prof. Iolanda"><option value="Prof. Denise"><option value="Prof. Lucas"><option value="Prof. Aline"><option value="Prof. Celso"><option value="Prof. Cristiano"><option value="Prof. Florisvaldo"><option value="Prof. Natalia"><option value="Prof. Priscila"><option value="Prof. Edislene"><option value="Prof. Marcia"><option value="Prof. Davi"><option value="Prof. Vanessa"><option value="Prof. Jo√£o">
    </datalist>

    <div id="toast-container" class="fixed bottom-6 right-6 flex flex-col gap-3 z-50 pointer-events-none"></div>
    <div id="footer-placeholder"></div>
    <script type="module" src="../assets/js/main.js"></script>

    <script>
        // DADOS REAIS DA ESCALA (Corrigido)
        // Feriados mapeados nas planilhas (01/05, 19/06) + Carnaval (04/03)
        const HOLIDAYS_2025 = ["2025-01-01", "2025-03-03", "2025-03-04", "2025-04-18", "2025-04-21", "2025-05-01", "2025-06-19", "2025-09-07", "2025-10-12", "2025-11-02", "2025-11-15", "2025-12-25"];
        
        // Disponibilidade baseada nos coment√°rios "PRO X N√ÉO PODE"
        const TEACHERS_DB = [
            { name: "Robson", unavailable: [3] }, // "PRO ROBSON N√ÉO PODE DE QUARTA"
            { name: "Andreia", available: [4, 6] }, // "PRO ANDREIA S√ì PODE QUINTA E S√ÅBADO"
            { name: "Pri", unavailable: [3] }, // "PRO PRI N√ÉO PODE DE QUARTA"
            { name: "Aline", available: [6] }, // "PRO ALINE S√ì AOS S√ÅBADOS"
            { name: "Elaine", available: [2] }, // "Pro Elaine pode: Terca..."
            { name: "Natalia", unavailable: [4] }, // "PRO NATALIA N√ÉO PODE" (quinta)
            { name: "Lucas", available: [] }, { name: "Iolanda", available: [] }, { name: "Denise", available: [] }, 
            { name: "Celso", available: [] }, { name: "Cristiano", available: [] }, { name: "Florisvaldo", available: [] },
            { name: "Edislene", available: [] }, { name: "Marcia", available: [] }, { name: "Davi", available: [] }, 
            { name: "Vanessa", available: [] }, { name: "Jo√£o", available: [] }
        ];

        // Mat√©rias Reais extra√≠das dos CRONOGRAMAS
        const courseTemplates = {
            'pedagogia': ["Introdu√ß√£o √† EAD", "Educa√ß√£o de Jovens e Adultos", "Gest√£o Educacional", "Pensamento Cient√≠fico", "Orienta√ß√µes sobre Est√°gio Supervisionado", "Educa√ß√£o das rela√ß√µes √©tnico - raciais", "Libras ‚Äì L√≠ngua Brasileira de Sinais", "Educa√ß√£o Inclusiva", "Transtornos e Dist√∫rbios da Aprendizagem", "Pol√≠ticas p√∫blicas e educa√ß√£o", "√âtica e Cidadania", "Educa√ß√£o Ambiental"],
            
            'neuro': ["Fundamentos da Neurologia/Neuroci√™ncia / Introdu√ß√£o √† Neuropedagogia", "NEUROCI√äNCIA DAS LINGUAGENS E MEM√ìRIA NEURONAL", "NEUROPSICOPEDAGOGIA E DEFICI√äNCIAS", "DID√ÅTICA DO ENSINO SUPERIOR/ METODOLOGIA CIENT√çFICA", "NEUROPSICOPEDAGOGIA E EDUCA√á√ÉO INCLUSIVA", "S√çNDROMES E PATOLOGIAS NO CONTEXTO DOS PROCESSOS DE ENSINO", "EDUCA√á√ÉO PSICOMOTORA E AS DIFICULDADES DE APRENDIZAGEM", "T√âCNICAS DE AVALIA√á√ÉO E DE INTERVEN√á√ÉO NO √ÇMBITO DA NEUROPSICOPEDAGOGIA", "FUNDAMENTOS DA APRENDIZAGEM / DESENVOLVIMENTO COGNITIVO"],
            
            'gestao': ["Bases te√≥ricas e pr√°ticas da gest√£o educacional", "Ci√™ncia da cogni√ß√£o, mem√≥ria e aprendizagem", "Planejamento e gest√£o estrat√©gica", "Gest√£o de pessoas motiva√ß√£o e reten√ß√£o de talentos", "Instrumentos utilizados no processo avaliativo", "Metodologia da Pesquisa Cient√≠fica / Metodologia do Ensino Superior"],
            
            'alfabetizacao': ["LETRAMENTO E ESINO DA L√çNGUA PORTUGUESA", "ALFABETIZA√á√ÉO JOVENS E ADULTOS / ALFABETIZA√á√ÉO E LETRAMENTO", "DID√ÅTICA E AVALIA√á√ÉO NA ALFABETIZA√á√ÉO", "FUNDAMENTOS DO LETRAMENTO E ALFABETIZA√á√ÉO HIST√ìRIA"],
            
            'psicologia': ["Psicologia do Desenvolvimento e da Aprendizagem / Fundamentos Filos√≥ficos", "Teorias da Aprendizagem e Educa√ß√£o Contempor√¢nea / Psicologia Cognitiva", "Educa√ß√£o Socioemocional e Aprendizagem / Habilidades Socioemocionais", "Psicologia da Inclus√£o e Educa√ß√£o Especial / Psicopedagogia", "Gest√£o de Conflitos e Rela√ß√µes Interpessoais na Escola", "Psicologia Escolar e Pol√≠ticas Educacionais / Sa√∫de Mental"],
            
            'inclusiva': ["Educa√ß√£o especial no mundo / Educa√ß√£o especial no Brasil", "Educa√ß√£o especial x Educa√ß√£o inclusiva / Princ√≠pios e fundamentos", "Os desafios dos professores na educa√ß√£o inclusiva / Capacita√ß√£o docente", "Par√¢metros curriculares nacionais e a educa√ß√£o inclusiva", "Tecnologia assistiva na educa√ß√£o inclusiva / Salas de recursos", "Avalia√ß√£o tradicional versus a avalia√ß√£o inclusiva"],

            'aee': ["Fundamentos da Educa√ß√£o Inclusiva e do Atendimento Educacional Especializado", "Pol√≠ticas P√∫blicas, Legisla√ß√£o e Direitos da Pessoa com Defici√™ncia", "Tecnologias Assistivas e Recursos Did√°ticos Acess√≠veis", "Altas Habilidades/Superdota√ß√£o: Identifica√ß√£o e Atendimento", "Pr√°ticas Pedag√≥gicas, Adapta√ß√µes Curriculares e Plano de AEE", "Fam√≠lia, Escola e Rede de Apoio no Processo Inclusivo"],

            'enem': ["Fundamentos da Educa√ß√£o / Antropologia da Educa√ß√£o", "Educa√ß√£o Infantil / Organiza√ß√£o do Trabalho Pedag√≥gico", "Educa√ß√£o a Dist√¢ncia e Novas Modalidades de Ensino / Metodologias Ativas", "LIBRAS / Educa√ß√£o Inclusiva", "Alfabetiza√ß√£o e Letramento / Transtornos e Dist√∫rbios", "Avalia√ß√£o da Aprendizagem / Curr√≠culos e Projetos Pedag√≥gicos", "Pol√≠ticas P√∫blicas e Legisla√ß√£o Educacional / √âtica e Cidadania"]
        };

        let currentSubjects = []; let calendar; let events = []; const LS_KEY_AGENDA = 'ODIN_PEDAGOGICO_AGENDA';

        document.addEventListener('DOMContentLoaded', () => { loadEvents(); initCalendar(); updateTicker(); renderUpcomingList(); updateLifecycle(); });

        // --- NEXUS DOCENTE ---
        function openReportModal() { document.getElementById('report-modal').classList.remove('hidden'); document.getElementById('report-month').value = new Date().toISOString().slice(0, 7); generateReport(); }
        function closeReportModal() { document.getElementById('report-modal').classList.add('hidden'); }
        function generateReport() {
            const monthInput = document.getElementById('report-month').value;
            const filteredEvents = events.filter(e => e.start.startsWith(monthInput) && e.extendedProps && e.extendedProps.profName);
            const report = {};
            filteredEvents.forEach(e => {
                const prof = e.extendedProps.profName;
                if(!report[prof]) report[prof] = { count: 0, classes: [] };
                report[prof].count++;
                report[prof].classes.push(`${e.start.split('-')[2]}: ${e.extendedProps.className}`);
            });
            const list = document.getElementById('report-list'); list.innerHTML = ''; let total = 0;
            for (const [prof, data] of Object.entries(report)) {
                total += data.count;
                list.innerHTML += `<div class="p-3 bg-dark-800 border-b border-dark-700 flex justify-between items-start"><div><p class="text-sm font-bold text-white">${prof}</p><p class="text-[10px] text-gray-500">${data.classes.join(', ')}</p></div><span class="text-neon-cyan font-bold text-sm">${data.count} Aulas</span></div>`;
            }
            if(total===0) list.innerHTML = '<p class="text-center text-gray-500 text-xs mt-4">Nenhuma aula registrada.</p>';
            document.getElementById('report-total').innerText = total;
        }
        function copyReport() {
            const month = document.getElementById('report-month').value;
            const items = document.querySelectorAll('#report-list > div');
            let text = `*RELAT√ìRIO DOCENTE - ${month}*\n\n`;
            items.forEach(item => { text += `üë§ ${item.querySelector('p.text-white').innerText}: ${item.querySelector('span.text-neon-cyan').innerText}\n`; });
            navigator.clipboard.writeText(text).then(() => showToast('Relat√≥rio copiado!', 'success'));
        }

        // --- NOTIFICADOR WHATSAPP ---
        function copyClassNotice() {
            const title = document.getElementById('evt-title').value;
            const dateVal = document.getElementById('evt-date').value;
            if(!dateVal) return;
            const dateBr = `${dateVal.split('-')[2]}/${dateVal.split('-')[1]}`;
            const evtId = document.getElementById('evt-id').value;
            let prof = "";
            if(evtId) { const evt = events.find(e => e.id === evtId); if(evt?.extendedProps?.profName) prof = ` com ${evt.extendedProps.profName}`; }
            const text = `üì¢ *AVISO DE AULA*\n\nOl√° pessoal! Passando para lembrar da nossa aula:\n\nüìÖ *Data:* ${dateBr}\nüìö *Mat√©ria:* ${title.split(':')[1] || title}${prof}\n‚è∞ *Hor√°rio:* Conforme cronograma\n\nContamos com a presen√ßa de todos!`;
            navigator.clipboard.writeText(text).then(() => showToast('Aviso copiado!', 'success'));
        }

        // --- CONSTRUTOR ---
        function openClassBuilder() { document.getElementById('class-builder-modal').classList.remove('hidden'); }
        function closeClassBuilder() { document.getElementById('class-builder-modal').classList.add('hidden'); }
        function loadTemplate() { const type=document.getElementById('builder-template').value; if(courseTemplates[type]) { currentSubjects=courseTemplates[type].map(s=>({date:'',name:s,prof:''})); renderBuilderList(); } }
        function renderBuilderList() { const list=document.getElementById('builder-list'); list.innerHTML=''; currentSubjects.forEach((s,i)=>{ list.innerHTML+=`<tr class="group hover:bg-dark-800 transition"><td class="pl-4 text-gray-500 text-xs">${i+1}</td><td><input type="date" value="${s.date}" class="bg-transparent w-full text-gray-300 text-xs" onchange="updateSubjectData(${i},'date',this.value)"></td><td><input type="text" value="${s.name}" class="bg-transparent w-full text-white text-sm" onchange="updateSubjectData(${i},'name',this.value)"></td><td><select class="bg-transparent w-full text-gray-400 text-xs outline-none border-b border-transparent focus:border-neon-cyan" onchange="checkConflict(${i},this.value);updateSubjectData(${i},'prof',this.value)">${getProfOptions(s.prof)}</select></td><td class="text-center"><button onclick="removeSubjectRow(${i})" class="text-gray-600 hover:text-red-500"><i class="fas fa-times"></i></button></td></tr>`; }); }
        function getProfOptions(s) { let o='<option value="">Selecione...</option>'; TEACHERS_DB.forEach(t=>{ o+=`<option value="Prof. ${t.name}" ${s===`Prof. ${t.name}`?'selected':''}>Prof. ${t.name}</option>`; }); return o; }
        function updateSubjectData(i,f,v) { currentSubjects[i][f]=v; }
        function addSubjectRow() { currentSubjects.push({date:'',name:"Nova Aula",prof:''}); renderBuilderList(); }
        function removeSubjectRow(i) { currentSubjects.splice(i,1); renderBuilderList(); }
        function checkConflict(i,p) { const d=currentSubjects[i].date; if(!d||!p)return; const c=events.find(e=>e.start===d && e.extendedProps?.profName===p); if(c){ alert(`CONFLITO: ${p} j√° tem aula em "${c.extendedProps.className}"!`); document.getElementById('conflict-alert').classList.remove('hidden'); } else document.getElementById('conflict-alert').classList.add('hidden'); }
        
        function generateDates() {
            const start=document.getElementById('builder-start').value, freq=document.getElementById('builder-freq').value, skip=document.getElementById('skip-holidays').checked;
            if(!start) return showToast('Data in√≠cio?', 'error');
            let curr=new Date(start+'T00:00:00');
            currentSubjects.forEach(s=>{
                while(true){ const ds=curr.toISOString().split('T')[0]; if(skip&&HOLIDAYS_2025.includes(ds)){curr.setDate(curr.getDate()+7);continue;} s.date=ds; break; }
                if(freq==='monthly') curr.setMonth(curr.getMonth()+1); else curr.setDate(curr.getDate()+7);
            });
            renderBuilderList(); showToast('Datas geradas!','success');
        }

        function saveClassToCalendar() {
            const name=document.getElementById('builder-name').value, time=document.getElementById('builder-time').value, cid='CLASS-'+Date.now();
            currentSubjects.forEach(s=>{ if(s.date) events.push({id:String(Date.now()+Math.random()),title:`${name}: ${s.name}`,start:s.date,backgroundColor:'#00FF94',borderColor:'#00FF94',extendedProps:{classId:cid,className:name,classTime:time,subjectName:s.name,profName:s.prof}}); });
            saveEventsToStorage(); closeClassBuilder(); showToast('Turma salva!','success'); location.reload();
        }
        function deleteEntireClass() { const cid=document.getElementById('evt-class-id').value; if(cid&&confirm("Excluir Turma?")){ events=events.filter(e=>!e.extendedProps||e.extendedProps.classId!==cid); saveEventsToStorage(); closeEventModal(); showToast('Exclu√≠do','success'); location.reload(); } }

        // AGENDA & CRUD
        function initCalendar() {
            calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
                initialView: 'dayGridMonth', locale: 'pt-br', headerToolbar: { left: 'prev,next today', center: 'title', right: 'dayGridMonth,listMonth' },
                height: '100%', events: events,
                dateClick: i => openEventModal(null, i.dateStr), eventClick: i => openEventModal(i.event)
            });
            calendar.render();
        }
        function loadEvents() { const d = localStorage.getItem(LS_KEY_AGENDA); if(d) events = JSON.parse(d); }
        function saveEventsToStorage() { localStorage.setItem(LS_KEY_AGENDA, JSON.stringify(events)); updateTicker(); updateLifecycle(); }
        function saveEvent() { const id=document.getElementById('evt-id').value, title=document.getElementById('evt-title').value, date=document.getElementById('evt-date').value, color=document.getElementById('evt-color').value; if(id) { const idx=events.findIndex(e=>e.id===id); if(idx>-1) events[idx]={...events[idx], title, start:date, backgroundColor:color, borderColor:color}; } else { events.push({id:String(Date.now()), title, start:date, backgroundColor:color, borderColor:color}); } saveEventsToStorage(); closeEventModal(); showToast('Salvo','success'); location.reload(); }
        function deleteEvent() { const id=document.getElementById('evt-id').value; if(id&&confirm("Excluir?")){ events=events.filter(e=>e.id!==id); saveEventsToStorage(); closeEventModal(); showToast('Apagado','info'); location.reload(); } }
        function openEventModal(e=null,d=null) { document.getElementById('event-modal').classList.remove('hidden'); if(e){document.getElementById('evt-id').value=e.id;document.getElementById('evt-title').value=e.title;document.getElementById('evt-date').value=e.startStr;document.getElementById('btn-delete').classList.remove('hidden'); if(e.extendedProps?.classId){document.getElementById('class-controls').classList.remove('hidden');document.getElementById('evt-class-id').value=e.extendedProps.classId;}else{document.getElementById('class-controls').classList.add('hidden');}}else{document.getElementById('evt-date').value=d||'';document.getElementById('class-controls').classList.add('hidden');document.getElementById('btn-delete').classList.add('hidden');} }
        function closeEventModal() { document.getElementById('event-modal').classList.add('hidden'); }
        function updateLifecycle() {
            const list=document.getElementById('lifecycle-list'), cls={}; list.innerHTML='';
            events.forEach(e=>{ if(e.extendedProps?.classId){ const c=e.extendedProps.classId; if(!cls[c]) cls[c]={name:e.extendedProps.className, total:0, passed:0}; cls[c].total++; if(new Date(e.start)<new Date()) cls[c].passed++; } });
            if(!Object.keys(cls).length) list.innerHTML='<p class="text-center text-xs text-gray-500">Nenhuma turma.</p>';
            Object.values(cls).forEach(c=>{ const p=Math.round((c.passed/c.total)*100); list.innerHTML+=`<div class="bg-dark-900 p-3 rounded border border-dark-700"><div class="flex justify-between mb-1"><span class="text-xs font-bold text-white">${c.name}</span><span class="text-[10px] text-neon-cyan">${p}%</span></div><div class="w-full bg-dark-800 h-1 rounded"><div class="bg-neon-cyan h-1 rounded" style="width:${p}%"></div></div></div>`; });
        }
        function renderUpcomingList() { const l=document.getElementById('upcoming-list'); l.innerHTML=''; const t=new Date().toISOString().split('T')[0]; events.filter(e=>e.start>=t).sort((a,b)=>a.start.localeCompare(b.start)).slice(0,5).forEach(e=>{ l.innerHTML+=`<div onclick="openEventFromId('${e.id}')" class="flex justify-between p-2 bg-dark-900 rounded border border-dark-600 hover:border-neon-cyan cursor-pointer"><span class="text-xs text-white truncate w-32">${e.title}</span><span class="text-[10px] text-gray-500">${e.start.split('-').reverse().join('/')}</span></div>`; }); }
        window.openEventFromId = id => { const e=calendar.getEventById(id); if(e) openEventModal(e); };
        function updateTicker() {
            const count = new Set(events.filter(e=>e.extendedProps?.classId).map(e=>e.extendedProps.classId)).size;
            document.getElementById('dynamic-ticker').innerHTML = `<span class="text-gray-400">TURMAS ATIVAS: <span class="text-neon-pink">${count}</span></span> <span class="text-gray-400">SENTINELA: <span class="text-neon-green">ATIVO</span></span>`;
        }
        function generatePDF(t,c,h,s){const{jsPDF}=window.jspdf;const doc=new jsPDF();doc.setFontSize(18);doc.text(t==='teacher'?"DI√ÅRIO":"CRONOGRAMA",14,20);doc.text(`TURMA: ${c} | ${h}`,14,30);const b=s.map(x=>[x.date.split('-').reverse().join('/'),x.name,t==='teacher'?x.prof:'']);doc.autoTable({startY:40,head:[['DATA','MAT√âRIA',t==='teacher'?'PROFESSOR':'']],body:b});doc.save('Doc.pdf');}
        function exportSchedulePDF(){generatePDF('student',document.getElementById('builder-name').value,document.getElementById('builder-time').value,currentSubjects);}
        function exportTeacherPDF(){generatePDF('teacher',document.getElementById('builder-name').value,document.getElementById('builder-time').value,currentSubjects);}
        function downloadClassPDF(){const c=document.getElementById('evt-class-id').value,e=events.filter(x=>x.extendedProps?.classId===c).sort((a,b)=>a.start.localeCompare(b.start));if(e.length)generatePDF('student',e[0].extendedProps.className,e[0].extendedProps.classTime,e.map(x=>({date:x.start,name:x.extendedProps.subjectName})));}
        function downloadTeacherPDF(){const c=document.getElementById('evt-class-id').value,e=events.filter(x=>x.extendedProps?.classId===c).sort((a,b)=>a.start.localeCompare(b.start));if(e.length)generatePDF('teacher',e[0].extendedProps.className,e[0].extendedProps.classTime,e.map(x=>({date:x.start,name:x.extendedProps.subjectName,prof:x.extendedProps.profName})));}
        function showToast(m,t='info'){const c=document.getElementById('toast-container'),el=document.createElement('div');el.className=`bg-dark-800 border-l-4 border-${t==='success'?'green':'red'}-500 text-white px-4 py-2 rounded shadow-lg mb-2`;el.innerText=m;c.appendChild(el);setTimeout(()=>el.remove(),3000);}
    </script>
</body>
</html>